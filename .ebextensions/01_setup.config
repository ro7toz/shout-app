# AWS Elastic Beanstalk Configuration
# Location: .ebextensions/01_setup.config

option_settings:
  # Application Environment
  aws:elasticbeanstalk:application:environment:
    SERVER_PORT: 5000
    SPRING_PROFILES_ACTIVE: aws
    
  # Java Platform
  aws:elasticbeanstalk:container:java:
    Xmx: 512m
    Xms: 256m
    
  # Load Balancer Health Check
  aws:elasticbeanstalk:environment:process:default:
    HealthCheckPath: /actuator/health
    HealthCheckTimeout: 5
    HealthCheckInterval: 30
    
  # Auto Scaling
  aws:autoscaling:asg:
    MinSize: 1
    MaxSize: 4
    
  # Instance Type
  aws:autoscaling:launchconfiguration:
    InstanceType: t3.small
    RootVolumeSize: 20
    
  # Environment Type
  aws:elasticbeanstalk:environment:
    EnvironmentType: LoadBalanced
    LoadBalancerType: application

# PostgreSQL RDS Connection
files:
  "/etc/profile.d/app_env.sh":
    mode: "000644"
    owner: root
    group: root
    content: |
      export RDS_DB_URL="${RDS_DB_URL}"
      export RDS_USERNAME="${RDS_USERNAME}"
      export RDS_PASSWORD="${RDS_PASSWORD}"

commands:
  01_install_postgresql_client:
    command: "sudo amazon-linux-extras install postgresql14 -y"
    ignoreErrors: true
